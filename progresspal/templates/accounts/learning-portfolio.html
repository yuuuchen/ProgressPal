{% extends 'base.html' %}
{% load static %}

{% block title %}å­¸ç”Ÿä¸­å¿ƒ | ProgressPal{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4 text-center">å­¸ç”Ÿä¸­å¿ƒ</h2>

    <!-- å„ç« ç¯€å­¸ç¿’æ™‚é–“ -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h5 class="card-title text-primary">å„ç« ç¯€ç´¯ç©å­¸ç¿’æ™‚é–“ï¼ˆåˆ†é˜ï¼‰</h5>
            <canvas id="chapterChart"></canvas>
        </div>
    </div>

    <!-- å„å–®å…ƒå­¸ç¿’æ™‚é–“ -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h5 class="card-title text-success">å„å–®å…ƒç´¯ç©å­¸ç¿’æ™‚é–“ï¼ˆåˆ†é˜ï¼‰</h5>
            <canvas id="unitChart"></canvas>
        </div>
    </div>

    <!-- æå•ç´€éŒ„ -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h5 class="card-title text-warning">ğŸ’¬ æå•ç´€éŒ„</h5>
            {% if question_logs %}
            <div class="table-responsive">
                <table class="table table-bordered table-striped align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>ç« ç¯€</th>
                            <th>å–®å…ƒ</th>
                            <th>å•é¡Œ</th>
                            <th>ç³»çµ±å›è¦†</th>
                            <th>æå•æ™‚é–“</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for q in question_logs %}
                        <tr>
                            <td>{{ q.chapter_code }}</td>
                            <td>{{ q.unit_code }}</td>
                            <td>{{ q.question }}</td>
                            <td>{{ q.answer|default:"ï¼ˆå°šç„¡å›è¦†ï¼‰" }}</td>
                            <td>{{ q.created_at|date:"Y-m-d H:i" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted">ç›®å‰å°šç„¡æå•ç´€éŒ„ã€‚</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const chapterCtx = document.getElementById('chapterChart');
    const unitCtx = document.getElementById('unitChart');

    const chapterLabels = JSON.parse('{{ chapter_labels|escapejs }}');
    const chapterValues = JSON.parse('{{ chapter_values|escapejs }}');
    const unitLabels = JSON.parse('{{ unit_labels|escapejs }}');
    const unitValues = JSON.parse('{{ unit_values|escapejs }}');

    new Chart(chapterCtx, {
        type: 'bar',
        data: {
            labels: chapterLabels,
            datasets: [{
                label: 'å­¸ç¿’æ™‚é–“ï¼ˆåˆ†é˜ï¼‰',
                data: chapterValues,
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'åˆ†é˜' } }
            }
        }
    });

    new Chart(unitCtx, {
        type: 'bar',
        data: {
            labels: unitLabels,
            datasets: [{
                label: 'å­¸ç¿’æ™‚é–“ï¼ˆåˆ†é˜ï¼‰',
                data: unitValues,
                backgroundColor: 'rgba(75, 192, 192, 0.6)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'åˆ†é˜' } }
            }
        }
    });
</script>
{% endblock %}
